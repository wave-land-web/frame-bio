<form
  id="contact-form"
  class="space-y-(--site-padding-sm) lsa no-repeat"
  method="POST"
  action="/api/forms/contact"
>
  <!-- First and Last Name -->
  <fieldset class="grid grid-cols-2 gap-(--site-padding-sm)">
    <legend class="sr-only">Personal Information</legend>
    <label class="sr-only" for="firstName">First Name (required)</label>
    <input
      type="text"
      name="firstName"
      id="firstName"
      placeholder="First Name*"
      class="w-full input input-primary"
      required
      aria-required="true"
    />
    <label class="sr-only" for="lastName">Last Name (required)</label>
    <input
      type="text"
      name="lastName"
      id="lastName"
      placeholder="Last Name*"
      class="w-full input input-primary"
      required
      aria-required="true"
    />
  </fieldset>

  <!-- Business Name -->
  <fieldset>
    <legend class="sr-only">Business Information</legend>
    <label class="sr-only" for="businessName">Business Name (required)</label>
    <input
      type="text"
      name="businessName"
      id="businessName"
      placeholder="Business Name*"
      class="w-full input input-primary"
      required
      aria-required="true"
    />
  </fieldset>

  <!-- Email + Phone -->
  <fieldset class="grid grid-cols-2 gap-(--site-padding-sm)">
    <legend class="sr-only">Contact Information</legend>
    <label class="sr-only" for="email">Email Address (required)</label>
    <input
      type="email"
      name="email"
      id="email"
      placeholder="Email*"
      class="w-full input input-primary"
      required
      aria-required="true"
      aria-describedby="email-help"
    />
    <label class="sr-only" for="phone">Phone Number (required)</label>
    <input
      type="tel"
      name="phone"
      id="phone"
      placeholder="Phone*"
      class="w-full input input-primary"
      required
      aria-required="true"
    />
  </fieldset>

  <!-- Message textarea -->
  <fieldset>
    <legend class="sr-only">Message (optional)</legend>
    <textarea
      name="message"
      id="message"
      placeholder="Message (optional)"
      class="w-full textarea textarea-primary"
      aria-required="false"></textarea>
  </fieldset>

  <!-- Email Subscription Checkbox -->
  <fieldset class="fieldset mb-8">
    <label
      class="label text-primary font-factoria gap-(--site-padding-sm) whitespace-normal uppercase text-left text-sm font-extrabold"
    >
      <input
        type="checkbox"
        name="isSubscribed"
        class="checkbox checkbox-secondary border-primary bg-base-100"
        checked
      />
      Yes! Of course I want to join your email list.
    </label>
  </fieldset>

  <!-- Submit Button -->
  <div class="flex md:justify-end mb-8">
    <button
      type="submit"
      class="bg-base-100 border border-secondary focus:outline-none focus:bg-secondary hover:bg-secondary w-52 flex justify-between px-0 z-10 group cursor-pointer"
    >
      <span
        class="p w-full p-4 font-extrabold group-hover:text-base-100 group-focus:text-base-100 transition-colors duration-200"
        >SEND INFO</span
      >
      <div
        class="w-1/3 h-full p-2 flex items-center bg-secondary fill-secondary-content group-hover:fill-base-100 group-focus:fill-base-100 transition-colors duration-200"
      >
        <svg
          class="-rotate-45 group-hover:rotate-0 group-focus:rotate-0 transition-transform duration-200"
          viewBox="0 0 20 20"
        >
          <path
            fill-rule="evenodd"
            d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
            clip-rule="evenodd"></path>
        </svg>
      </div>
    </button>
  </div>

  <!-- Form Messages -->
  <div id="form-messages" class="hidden text-base-100 text-left">
    <div
      id="success-message"
      class="hidden flex-col md:flex-row items-start gap-6 p-6 bg-success border border-base-100 rounded-lg"
    >
      <h3 class="uppercase h4 font-bold">Success!</h3>
      <p>
        We've received your information and will get back to you shortly. You've also been added to
        our mailing list. We limit our emails to only a few a year, and we never sell your
        information to others. If you ever find that these emails no longer fit your fancy, you can
        unsubscribe anytime.
      </p>
    </div>
    <div
      id="error-message"
      class="hidden flex-col md:flex-row items-start gap-6 p-6 bg-error border border-base-100 rounded-lg"
    >
      <h3 class="uppercase h4 font-bold">Yikes!</h3>
      <p>
        For some reason, the form did not submit correctly. Please make sure you've completed all
        the required fields and try to send the information again.
      </p>
    </div>
  </div>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('contact-form') as HTMLFormElement
    const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement
    const submitText = submitButton.querySelector('span')

    // Message elements
    const formMessages = document.getElementById('form-messages')
    const successMessage = document.getElementById('success-message')
    const errorMessage = document.getElementById('error-message')

    function hideMessages() {
      formMessages?.classList.add('hidden')
      successMessage?.classList.add('hidden')
      successMessage?.classList.remove('flex')
      errorMessage?.classList.add('hidden')
      errorMessage?.classList.remove('flex')
    }

    function showSuccessMessage() {
      hideMessages()
      formMessages?.classList.remove('hidden')
      successMessage?.classList.remove('hidden')
      successMessage?.classList.add('flex')

      // Scroll to message
      formMessages?.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
    }

    function updateSuccessMessage(isSubscribed: boolean) {
      const successParagraph = successMessage?.querySelector('p')
      if (successParagraph) {
        if (isSubscribed) {
          successParagraph.textContent =
            "We've received your information and will get back to you shortly. You've also been added to our mailing list. We limit our emails to only a few a year, and we never sell your information to others. If you ever find that these emails no longer fit your fancy, you can unsubscribe anytime."
        } else {
          successParagraph.textContent =
            "We've received your information and will get back to you shortly. Feel free to submit again with a checked box at anytime to subscribe for updates."
        }
      }
    }

    function showErrorMessage() {
      hideMessages()
      formMessages?.classList.remove('hidden')
      errorMessage?.classList.remove('hidden')
      errorMessage?.classList.add('flex')

      // Scroll to message
      formMessages?.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
    }

    if (form && submitButton && submitText) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault()
        hideMessages()

        // Disable submit button and update text
        submitButton.disabled = true
        const originalText = submitText.textContent
        submitText.textContent = 'SENDING...'

        try {
          const formData = new FormData(form)
          const response = await fetch('/api/forms/contact', {
            method: 'POST',
            body: formData,
          })

          const result = await response.json()

          if (result.success) {
            updateSuccessMessage(result.isSubscribed)
            showSuccessMessage()
            form.reset()
          } else {
            showErrorMessage()
          }
        } catch (error) {
          console.error('Form submission error:', error)
          showErrorMessage()
        } finally {
          // Re-enable submit button and restore text
          submitButton.disabled = false
          if (submitText && originalText) {
            submitText.textContent = originalText
          }
        }
      })
    }
  })
</script>
